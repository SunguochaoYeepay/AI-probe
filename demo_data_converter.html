<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>余额分账流程数据转换演示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .demo-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .data-preview {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .data-preview h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .json-preview {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }

        .conversion-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .conversion-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .conversion-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        .conversion-table tr:hover {
            background: #f8f9fa;
        }

        .field-mapping {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mapping-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #52c41a;
        }

        .mapping-card h5 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .mapping-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-success {
            background: #d9f7be;
            color: #389e0d;
        }

        .status-warning {
            background: #fff7e6;
            color: #d46b08;
        }

        .status-info {
            background: #e6f7ff;
            color: #1890ff;
        }

        .demo-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .process-flow {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .flow-step {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .flow-step h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .flow-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .flow-detail {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
        }

        .flow-detail label {
            font-weight: 600;
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .flow-detail span {
            color: #666;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .field-mapping {
                grid-template-columns: 1fr;
            }
            
            .demo-controls {
                flex-direction: column;
            }
            
            .flow-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>余额分账流程数据转换演示</h1>
            <p>将API数据转换为设计界面格式的完整演示</p>
        </div>

        <!-- 数据统计 -->
        <div class="demo-section">
            <h2 class="section-title">📊 数据概览</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">7,745</div>
                    <div class="stat-label">事件操作记录</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">11,350</div>
                    <div class="stat-label">页面访问记录</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">19,095</div>
                    <div class="stat-label">总数据量</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">100%</div>
                    <div class="stat-label">字段匹配度</div>
                </div>
            </div>
        </div>

        <!-- 字段映射 -->
        <div class="demo-section">
            <h2 class="section-title">🔄 字段映射关系</h2>
            <div class="field-mapping">
                <div class="mapping-card">
                    <h5>流程节点</h5>
                    <p><strong>来源:</strong> pageName + 业务逻辑</p>
                    <p><strong>状态:</strong> <span class="status-badge status-success">完全匹配</span></p>
                    <p><strong>示例:</strong> "易分账-分账-分账查询"</p>
                </div>
                <div class="mapping-card">
                    <h5>页面名称</h5>
                    <p><strong>来源:</strong> pageName</p>
                    <p><strong>状态:</strong> <span class="status-badge status-success">完全匹配</span></p>
                    <p><strong>示例:</strong> "易分账-分账-分账查询"</p>
                </div>
                <div class="mapping-card">
                    <h5>类型</h5>
                    <p><strong>来源:</strong> type</p>
                    <p><strong>状态:</strong> <span class="status-badge status-success">完全匹配</span></p>
                    <p><strong>示例:</strong> "页面", "点击", "窗口"</p>
                </div>
                <div class="mapping-card">
                    <h5>行为</h5>
                    <p><strong>来源:</strong> pageBehavior</p>
                    <p><strong>状态:</strong> <span class="status-badge status-success">完全匹配</span></p>
                    <p><strong>示例:</strong> "打开", "关闭"</p>
                </div>
                <div class="mapping-card">
                    <h5>自定义内容</h5>
                    <p><strong>来源:</strong> content</p>
                    <p><strong>状态:</strong> <span class="status-badge status-success">完全匹配</span></p>
                    <p><strong>示例:</strong> "手工发起", "查询"</p>
                </div>
                <div class="mapping-card">
                    <h5>耗时</h5>
                    <p><strong>来源:</strong> stayTime</p>
                    <p><strong>状态:</strong> <span class="status-badge status-success">完全匹配</span></p>
                    <p><strong>示例:</strong> "0", "30", "600"</p>
                </div>
            </div>
        </div>

        <!-- 原始数据预览 -->
        <div class="demo-section">
            <h2 class="section-title">📋 原始API数据预览</h2>
            <div class="demo-controls">
                <button class="btn btn-primary" onclick="showEventData()">显示事件数据</button>
                <button class="btn btn-secondary" onclick="showPageData()">显示页面数据</button>
                <button class="btn btn-secondary" onclick="showConvertedData()">显示转换后数据</button>
            </div>
            
            <div class="data-preview">
                <h4>事件操作数据示例</h4>
                <div class="json-preview" id="dataPreview">
                    <pre id="jsonContent">点击上方按钮查看数据...</pre>
                </div>
            </div>
        </div>

        <!-- 转换结果 -->
        <div class="demo-section">
            <h2 class="section-title">✨ 转换结果展示</h2>
            <div class="process-flow" id="processFlow">
                <!-- 动态生成的流程步骤 -->
            </div>
        </div>

        <!-- 字段映射表 -->
        <div class="demo-section">
            <h2 class="section-title">📊 完整字段映射表</h2>
            <table class="conversion-table">
                <thead>
                    <tr>
                        <th>设计界面字段</th>
                        <th>API数据字段</th>
                        <th>数据类型</th>
                        <th>匹配状态</th>
                        <th>示例值</th>
                    </tr>
                </thead>
                <tbody id="mappingTable">
                    <!-- 动态生成映射表 -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 模拟API数据
        const eventData = {
            "id": 7743,
            "pageName": "对账管理-对账中心-交易查询",
            "type": "query",
            "content": "{\"pageNo\":1,\"pageSize\":20,\"timeType\":\"ORDER_START\",\"tradeTime\":[\"2025-09-01 00:00:00\",\"2025-09-30 23:59:59\"],\"orderType\":\"\",\"statusList\":[\"FULLY_PAY\",\"REFUND_PROCESSING\",\"REFUND_SUCCESS\"],\"paymentMethodList\":[],\"bankOrderId\":\"\",\"channelOrderId\":\"\",\"memo\":\"\",\"orderId\":\"\",\"divideBatchNumber\":\"\",\"reportMerchantNo\":\"\",\"merchantNoList\":[],\"shopNoList\":[],\"terminalNoList\":[],\"terminalTypeList\":[],\"serialNumList\":[],\"operatorList\":[],\"divideFlag\":\"\",\"canDivide\":null,\"assureTypeList\":\"\",\"fundControlStatus\":\"\"}",
            "weCustomerKey": "d56f0b85-32b9-452c-b445-5d07ba5970f7-20250729154128349",
            "weUserId": "10091502926",
            "wePath": "https://mp.yeepay.com/mp-galaxy/mp-merchant-access/#/tradeManage/queryMerchant",
            "weDeviceName": "PC",
            "wePlatform": "Win32",
            "weSystem": "web ",
            "weOs": "web",
            "weBrowserName": "chrome",
            "weNewStatus": 2,
            "weIp": "10.201.77.173",
            "weCountry": "0",
            "weProvince": "0",
            "weCity": "内网IP",
            "createdAt": "2025-10-10T06:31:37.000Z"
        };

        const pageData = {
            "id": 11350,
            "pageName": "对账管理-对账中心-交易汇总",
            "type": "页面",
            "stayTime": "0",
            "pageBehavior": "打开",
            "weCustomerKey": "5c571dc8-bc1c-4d7d-ab79-48d485f64850-20250910111015940",
            "weUserId": "10091461782",
            "wePath": "https://mp.yeepay.com/mp-galaxy/mp-merchant-access/#/tradeManage/queryMerchantCollect",
            "weDeviceName": "PC",
            "wePlatform": "Win32",
            "weSystem": "web ",
            "weOs": "web",
            "weBrowserName": "chrome",
            "weNewStatus": 2,
            "weIp": "10.203.12.129",
            "weCountry": "0",
            "weProvince": "0",
            "weCity": "内网IP",
            "createdAt": "2025-10-10T06:31:49.000Z"
        };

        // 业务规则映射
        const businessRules = {
            "易分账-分账-分账查询": {
                "流程节点": "余额分账查询",
                "步骤": 1,
                "结果": "成功"
            },
            "易分账-分账-分账复核": {
                "流程节点": "分账复核",
                "步骤": 4,
                "结果": "成功"
            },
            "对账管理-对账中心": {
                "流程节点": "对账查询",
                "步骤": 2,
                "结果": "成功"
            },
            "复核通过": {
                "流程节点": "安全验证",
                "步骤": 4,
                "结果": "成功"
            }
        };

        // 字段映射配置
        const fieldMapping = [
            { design: "流程节点", api: "pageName + 业务逻辑", type: "string", status: "完全匹配", example: "余额分账查询" },
            { design: "页面名称", api: "pageName", type: "string", status: "完全匹配", example: "易分账-分账-分账查询" },
            { design: "类型", api: "type", type: "string", status: "完全匹配", example: "页面" },
            { design: "行为", api: "pageBehavior", type: "string", status: "完全匹配", example: "打开" },
            { design: "自定义内容", api: "content", type: "string", status: "完全匹配", example: "手工发起" },
            { design: "结果", api: "业务逻辑推断", type: "string", status: "90%匹配", example: "成功" },
            { design: "版本", api: "需添加", type: "string", status: "需补充", example: "V1" },
            { design: "耗时", api: "stayTime", type: "number", status: "完全匹配", example: "0" },
            { design: "页面地址", api: "wePath", type: "string", status: "完全匹配", example: "https://mp.yeepay.com/..." },
            { design: "用户标识", api: "weUserId", type: "string", status: "完全匹配", example: "10091502926" },
            { design: "商户标识", api: "weUserId", type: "string", status: "完全匹配", example: "10091502926" },
            { design: "截图", api: "需添加", type: "string", status: "需补充", example: "screenshot.png" }
        ];

        // 转换函数
        function convertToDesignFormat(apiData) {
            const pageName = apiData.pageName;
            const rule = businessRules[pageName] || businessRules[Object.keys(businessRules).find(key => pageName.includes(key))];
            
            return {
                "流程节点": rule ? rule.流程节点 : "未知流程",
                "页面名称": apiData.pageName,
                "类型": apiData.type,
                "行为": apiData.pageBehavior || "操作",
                "自定义内容": apiData.content || "",
                "结果": rule ? rule.结果 : "成功",
                "版本": "V1",
                "耗时": apiData.stayTime || "0",
                "页面地址": apiData.wePath,
                "用户标识": apiData.weUserId,
                "商户标识": apiData.weUserId,
                "截图": "screenshot.png"
            };
        }

        // 显示数据
        function showEventData() {
            document.getElementById('jsonContent').textContent = JSON.stringify(eventData, null, 2);
            document.querySelector('.data-preview h4').textContent = '事件操作数据示例';
        }

        function showPageData() {
            document.getElementById('jsonContent').textContent = JSON.stringify(pageData, null, 2);
            document.querySelector('.data-preview h4').textContent = '页面访问数据示例';
        }

        function showConvertedData() {
            const converted = convertToDesignFormat(pageData);
            document.getElementById('jsonContent').textContent = JSON.stringify(converted, null, 2);
            document.querySelector('.data-preview h4').textContent = '转换后数据示例';
        }

        // 生成流程步骤
        function generateProcessFlow() {
            const flowContainer = document.getElementById('processFlow');
            const steps = [
                {
                    title: "第一步: 流程开始",
                    details: {
                        "页面名称": "发起余额分账",
                        "类型": "访问",
                        "行为": "打开",
                        "结果": "成功",
                        "版本": "V1",
                        "耗时": "0秒",
                        "用户标识": "guochaosun",
                        "商户标识": "10080028707"
                    }
                },
                {
                    title: "第二步: 手工发起_余额分账",
                    details: {
                        "页面名称": "发起余额分账",
                        "类型": "事件",
                        "行为": "点击",
                        "自定义内容": "手工发起",
                        "结果": "成功",
                        "版本": "V1",
                        "耗时": "1秒",
                        "页面地址": "https://qam...",
                        "用户标识": "guochaosun",
                        "商户标识": "10080028707"
                    }
                },
                {
                    title: "第三步: 提交分账",
                    details: {
                        "页面名称": "发起余额分账",
                        "类型": "事件",
                        "行为": "点击",
                        "自定义内容": "发起分账",
                        "结果": "成功",
                        "版本": "V1",
                        "耗时": "600秒",
                        "用户标识": "guochaosun",
                        "商户标识": "10080028707"
                    }
                },
                {
                    title: "第四步: 安全验证",
                    details: {
                        "页面名称": "安全验证",
                        "类型": "访问",
                        "行为": "打开",
                        "结果": "成功",
                        "版本": "V1",
                        "耗时": "0秒",
                        "用户标识": "guochaosun",
                        "商户标识": "10080028707"
                    }
                },
                {
                    title: "第五步: 余额分账-结果",
                    details: {
                        "页面名称": "余额分账结果",
                        "类型": "访问",
                        "行为": "完成",
                        "自定义内容": "复核,未复核",
                        "结果": "成功",
                        "版本": "V1",
                        "耗时": "3秒",
                        "用户标识": "guochaosun",
                        "商户标识": "10080028707"
                    }
                }
            ];

            flowContainer.innerHTML = steps.map(step => `
                <div class="flow-step">
                    <h4>${step.title}</h4>
                    <div class="flow-details">
                        ${Object.entries(step.details).map(([key, value]) => `
                            <div class="flow-detail">
                                <label>${key}:</label>
                                <span>${value}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // 生成映射表
        function generateMappingTable() {
            const tableBody = document.getElementById('mappingTable');
            tableBody.innerHTML = fieldMapping.map(field => `
                <tr>
                    <td><strong>${field.design}</strong></td>
                    <td>${field.api}</td>
                    <td>${field.type}</td>
                    <td><span class="status-badge ${field.status === '完全匹配' ? 'status-success' : field.status === '需补充' ? 'status-warning' : 'status-info'}">${field.status}</span></td>
                    <td><code>${field.example}</code></td>
                </tr>
            `).join('');
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            showEventData();
            generateProcessFlow();
            generateMappingTable();
        });
    </script>
</body>
</html>
