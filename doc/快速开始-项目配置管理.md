# 项目配置管理 - 快速开始指南

## 📋 概述

本指南将帮助您快速上手使用新增的项目配置管理功能，包括团队列表获取和项目点位管理。

## 🚀 快速开始

### 1. 启动项目

```bash
# 安装依赖（首次运行）
npm install

# 启动开发服务器
npm run dev
```

### 2. 访问配置管理页面

在浏览器中打开：
```
http://localhost:5173/project-config
```

### 3. 使用界面操作

#### 获取团队列表
1. 点击 "获取团队列表" 按钮
2. 系统将自动显示所有团队信息
3. 可以查看团队名称、ID等详细信息

#### 获取项目点位
1. 点击 "获取项目点位" 按钮
2. 系统将加载当前项目的所有埋点配置
3. 支持搜索功能，快速查找特定点位

#### 刷新所有数据
点击 "刷新所有" 按钮，一次性更新所有配置数据

## 💻 代码集成

### 方法 1：使用 Composable（推荐）

```vue
<script setup>
import { onMounted } from 'vue'
import { useProjectConfig } from '@/composables/useProjectConfig'

const {
  teamList,
  pointList,
  loading,
  error,
  fetchTeamList,
  fetchProjectAndPoints
} = useProjectConfig()

onMounted(async () => {
  // 获取团队列表
  await fetchTeamList()
  console.log('团队列表:', teamList.value)
  
  // 获取项目点位
  const result = await fetchProjectAndPoints()
  console.log('点位列表:', result.points)
})
</script>

<template>
  <div>
    <div v-for="team in teamList" :key="team.id">
      {{ team.name }}
    </div>
  </div>
</template>
```

### 方法 2：直接使用 API

```javascript
import { yeepayAPI } from '@/api'

// 获取团队列表
async function getTeams() {
  try {
    const response = await yeepayAPI.getTeamList()
    console.log('团队列表:', response.data)
    return response.data
  } catch (error) {
    console.error('获取失败:', error)
  }
}

// 获取项目点位
async function getPoints() {
  try {
    const response = await yeepayAPI.getProjectAndPoints('event1021')
    console.log('点位列表:', response.data)
    return response.data
  } catch (error) {
    console.error('获取失败:', error)
  }
}
```

## 🔍 常见场景

### 场景 1：查找特定点位

```javascript
import { useProjectConfig } from '@/composables/useProjectConfig'

const { 
  fetchProjectAndPoints, 
  findPointByName 
} = useProjectConfig()

// 加载点位列表
await fetchProjectAndPoints()

// 查找特定点位
const visitPoint = findPointByName('页面访问埋点')
console.log('找到点位:', visitPoint)
```

### 场景 2：获取所有点位ID

```javascript
import { useProjectConfig } from '@/composables/useProjectConfig'

const { 
  fetchProjectAndPoints, 
  getAllPointIds 
} = useProjectConfig()

await fetchProjectAndPoints()
const allIds = getAllPointIds()
console.log('所有点位ID:', allIds)
```

### 场景 3：搜索和过滤点位

```vue
<script setup>
import { ref, computed } from 'vue'
import { useProjectConfig } from '@/composables/useProjectConfig'

const { pointList, fetchProjectAndPoints } = useProjectConfig()
const searchText = ref('')

const filteredPoints = computed(() => {
  if (!searchText.value) return pointList.value
  
  return pointList.value.filter(point => {
    const name = point.name || ''
    return name.toLowerCase().includes(searchText.value.toLowerCase())
  })
})

// 加载数据
fetchProjectAndPoints()
</script>

<template>
  <div>
    <input v-model="searchText" placeholder="搜索点位" />
    <div v-for="point in filteredPoints" :key="point.id">
      {{ point.name }}
    </div>
  </div>
</template>
```

## 🧪 测试接口

### 浏览器控制台测试

在浏览器控制台中运行以下代码：

```javascript
// 加载测试脚本
const script = document.createElement('script')
script.src = '/doc/test_new_apis.js'
document.head.appendChild(script)

// 等待脚本加载完成后执行
setTimeout(() => {
  // 测试原始API
  testNewAPIs()
  
  // 测试Vue集成API
  testWithVueAPI()
}, 1000)
```

### 使用 curl 测试

```bash
# 测试获取团队列表
curl 'https://probe.yeepay.com/wfManage/getSimpleTeamList' \
  -H 'access-token: YOUR_TOKEN' \
  -H 'content-type: text/plain;charset=UTF-8' \
  --data-raw '{}'

# 测试获取项目点位
curl 'https://probe.yeepay.com/tracker/buryPointWarehouse/getProjectAndWeList' \
  -H 'access-token: YOUR_TOKEN' \
  -H 'content-type: text/plain;charset=UTF-8' \
  --data-raw '{"projectId":"event1021"}'
```

## 📊 数据结构

### 团队列表响应格式

```javascript
{
  "code": 0,
  "success": true,
  "data": [
    {
      "id": "team_id_1",
      "name": "团队名称",
      "teamName": "团队名称",
      // ... 其他字段
    }
  ]
}
```

### 项目点位响应格式

```javascript
{
  "code": 0,
  "success": true,
  "data": {
    "projectInfo": {
      "id": "event1021",
      "name": "项目名称",
      // ... 其他字段
    },
    "weList": [
      {
        "id": 110,
        "name": "页面访问埋点",
        "pointName": "页面访问埋点",
        "type": "single",
        // ... 其他字段
      }
    ]
  }
}
```

## ⚙️ 配置说明

### 修改项目ID

在 `src/config/api.js` 中修改：

```javascript
environments: {
  development: {
    projectId: "your_project_id", // 修改这里
    // ...
  }
}
```

### 修改访问令牌

在 `src/config/api.js` 中修改：

```javascript
environments: {
  development: {
    accessToken: "your_access_token", // 修改这里
    // ...
  }
}
```

## 🐛 故障排查

### 问题 1：接口返回 401 错误

**原因**：访问令牌失效或不正确

**解决方案**：
1. 检查 `src/config/api.js` 中的 `accessToken` 配置
2. 更新为最新的有效令牌

### 问题 2：返回空数据

**原因**：项目ID不存在或没有权限

**解决方案**：
1. 确认项目ID是否正确
2. 检查账号是否有访问权限

### 问题 3：跨域错误

**原因**：开发环境跨域限制

**解决方案**：
1. 检查 `vite.config.js` 代理配置
2. 或在生产环境中测试

## 📚 相关文档

- [API使用示例](./API使用示例.md) - 详细的API使用说明
- [更新日志](../CHANGELOG.md) - 查看完整的更新记录
- [README](../README.md) - 项目总体说明

## 💡 最佳实践

1. **错误处理**：始终使用 try-catch 包裹异步调用
2. **加载状态**：使用 loading 状态提供用户反馈
3. **缓存管理**：避免频繁重复请求相同数据
4. **类型检查**：使用可选链运算符 `?.` 安全访问嵌套属性

## 🎯 下一步

- [ ] 尝试在控制台测试 API
- [ ] 集成到现有组件中
- [ ] 自定义点位选择逻辑
- [ ] 添加本地缓存优化

---

如有问题，请查看 [API使用示例](./API使用示例.md) 或联系开发团队。

