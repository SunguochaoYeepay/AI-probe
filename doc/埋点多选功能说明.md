# 埋点多选功能说明

## 功能概述

在项目配置中，用户选择项目后可以自动加载该项目的所有埋点，并通过下拉多选框选择要使用的埋点。

## 功能特性

### 1. 自动加载埋点
- **触发时机**：选择项目后自动加载
- **默认行为**：自动选中所有埋点
- **加载反馈**：显示加载的埋点数量

### 2. 多选埋点
- **选择方式**：下拉多选框
- **搜索功能**：支持按埋点名称、ID、描述搜索
- **显示优化**：最多显示3个标签，超出折叠显示
- **智能识别**：系统自动识别访问埋点和点击埋点

### 3. 实时反馈
- **配置状态**：实时显示访问埋点和点击埋点状态
- **提示信息**：未选择埋点时显示警告
- **更新通知**：选择变更时自动更新配置

## 使用流程

### 1. 选择项目
```
1. 打开系统配置管理
2. 在"项目配置"标签页选择项目
3. 系统自动加载该项目的所有埋点
4. 默认选中所有埋点
```

### 2. 选择埋点
```
1. 在"选择埋点"下拉框中选择要使用的埋点
2. 支持多选，可以选择多个埋点
3. 支持搜索，输入关键词快速查找
4. 系统自动识别访问埋点和点击埋点
```

### 3. 查看状态
```
1. 在"当前埋点配置"区域查看配置状态
2. 绿色标签表示已配置，红色标签表示未配置
3. 显示具体的埋点名称和ID
```

## 界面设计

### 项目配置界面
```
项目配置
├── 当前项目 (项目选择器)
├── 访问令牌 (密码输入框)
├── 选择埋点 (多选下拉框) ✨ 新功能
│   ├── 支持多选
│   ├── 支持搜索
│   └── 自动加载
└── 当前埋点配置 (状态显示)
    ├── 访问埋点状态
    └── 点击埋点状态
```

## 技术实现

### 1. 组件设计

**多选下拉框**：
```vue
<a-select
  v-model:value="selectedBuryPointIds"
  mode="multiple"
  placeholder="请选择要使用的埋点（可多选）"
  show-search
  :filter-option="filterBuryPoint"
  :max-tag-count="3"
>
  <a-select-option
    v-for="point in currentBuryPoints.buryPoints"
    :key="point.id"
    :value="point.id"
  >
    {{ point.name }} (ID: {{ point.id }})
  </a-select-option>
</a-select>
```

### 2. 自动加载逻辑

**选择项目时**：
```javascript
const onProjectSelect = async (projectId) => {
  await selectProject(projectId)
  
  // 自动选中所有埋点
  if (currentBuryPoints.value?.buryPoints?.length > 0) {
    selectedBuryPointIds.value = currentBuryPoints.value.buryPoints.map(point => point.id)
  }
  
  // 发送配置更新事件
  emit('project-config-updated', {
    projectId,
    config: currentBuryPoints.value,
    selectedBuryPointIds: selectedBuryPointIds.value
  })
}
```

### 3. 埋点搜索过滤

```javascript
const filterBuryPoint = (input, option) => {
  const point = currentBuryPoints.value?.buryPoints?.find(p => p.id === option.value)
  const searchText = input.toLowerCase()
  
  return (
    point.name.toLowerCase().includes(searchText) ||
    point.id.toString().toLowerCase().includes(searchText) ||
    (point.description && point.description.toLowerCase().includes(searchText))
  )
}
```

### 4. 状态管理

**Vuex Store**：
```javascript
projectConfig: {
  currentProject: null,
  buryPoints: [],
  visitPoint: null,
  clickPoint: null,
  selectedBuryPointIds: [] // 用户选中的埋点ID列表
}
```

## 用户体验优化

### 1. 自动化
- ✅ 选择项目后自动加载埋点
- ✅ 自动选中所有埋点（可手动调整）
- ✅ 自动识别埋点类型

### 2. 搜索功能
- ✅ 支持埋点名称搜索
- ✅ 支持埋点ID搜索
- ✅ 支持埋点描述搜索

### 3. 视觉反馈
- ✅ 实时显示配置状态
- ✅ 颜色标识（绿色/红色）
- ✅ 未选择埋点时显示警告

### 4. 操作便捷
- ✅ 多选支持
- ✅ 快捷搜索
- ✅ 标签折叠显示

## 应用场景

### 1. 单埋点场景
```
用户只需要使用一个埋点：
1. 选择项目
2. 在下拉框中只选择一个埋点
3. 系统自动配置
```

### 2. 多埋点场景
```
用户需要使用多个埋点：
1. 选择项目
2. 在下拉框中选择多个埋点
3. 系统自动识别访问埋点和点击埋点
```

### 3. 搜索场景
```
埋点列表很长，需要快速查找：
1. 选择项目
2. 在搜索框中输入关键词
3. 从过滤后的结果中选择
```

## 优势

### 1. 灵活性
- ✅ 支持单选和多选
- ✅ 支持快速搜索
- ✅ 支持动态调整

### 2. 自动化
- ✅ 自动加载埋点列表
- ✅ 自动选中所有埋点
- ✅ 自动识别埋点类型

### 3. 易用性
- ✅ 界面简洁直观
- ✅ 操作流程清晰
- ✅ 实时状态反馈

## 相关文件

### 修改的文件
- `src/components/ConfigModal.vue` - 添加埋点多选功能
- `src/views/Home.vue` - 处理埋点选择事件
- `src/store/index.js` - 存储选中的埋点ID

### 保持不变的文件
- `src/composables/useProjectConfig.js` - 核心逻辑
- `src/api/probeService.js` - API 服务

## 总结

通过埋点多选功能，用户可以：

- ✅ **自动加载**：选择项目后自动加载埋点列表
- ✅ **灵活选择**：通过下拉多选框选择需要的埋点
- ✅ **快速搜索**：支持按名称、ID、描述搜索
- ✅ **实时反馈**：显示当前埋点配置状态

现在用户可以根据实际需求灵活选择使用哪些埋点，操作更加便捷高效！
