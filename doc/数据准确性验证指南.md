# 数据准确性验证指南

## 快速验证方法

### 方法一：浏览器控制台验证

在浏览器控制台（F12）中执行以下代码：

```javascript
// 导入验证工具
import { dataVerificationTool } from '@/utils/dataVerificationTool'
import { useStore } from 'vuex'

// 获取当前配置
const store = useStore()
const selectedPointIds = store.state.projectConfig?.selectedBuryPointIds || []

// 验证10月11日的数据
async function verifyOct11() {
  const date = '2025-10-11'
  const pointId = selectedPointIds[0] || 175 // 使用第一个选中的埋点，或默认175
  
  console.log('开始验证10月11日数据...')
  const result = await dataVerificationTool.verifyDataAccuracy(date, pointId, {
    detailed: true,
    sampleSize: 50
  })
  
  console.log('验证结果:', result)
  return result
}

// 执行验证
verifyOct11()
```

### 方法二：使用验证UI组件

1. 打开系统配置
2. 切换到"缓存管理"标签
3. 点击"完整检查"按钮
4. 查看详细的验证报告

## 验证指标说明

### 1. 数据量检查 (data_count)
- ✅ 通过：缓存数据量 = API数据量
- ⚠️ 警告：差异 < 10%
- ❌ 失败：差异 ≥ 10%

### 2. 数据结构检查 (data_structure)
- 检查缓存数据和API数据的字段是否一致
- 识别缺失或多余的字段

### 3. 时间戳检查 (timestamps)
- ✅ 通过：时间差 < 5分钟
- ⚠️ 警告：时间差 5-60分钟
- ❌ 失败：时间差 > 1小时

### 4. 内容抽样检查 (content_samples)
- 随机抽取样本对比关键字段
- 检查 id, pageName, type, weCustomerKey 等字段

### 5. UV一致性检查 (unique_users)
- 对比唯一用户数（去重后的weCustomerKey）
- ⚠️ 警告：差异 > 10%

### 6. 缓存元数据检查 (cache_metadata)
- 检查缓存创建时间和过期时间
- ⚠️ 警告：缓存超过12小时
- ❌ 失败：缓存已过期

## 常见问题

### Q1: 数据量不一致怎么办？
**A:** 执行强制刷新：
1. 点击顶部"缓存"按钮
2. 选择"强制刷新"
3. 等待数据重新加载

### Q2: 如何批量验证多天数据？
**A:** 使用批量验证功能：
```javascript
const dates = ['2025-10-10', '2025-10-11', '2025-10-12']
const pointIds = [175] // 你的埋点ID

const result = await dataVerificationTool.verifyMultipleDays(dates, pointIds, {
  detailed: true
})
```

### Q3: 验证显示"时间戳过时"？
**A:** 这表示缓存数据较旧，建议：
1. 检查数据预加载设置
2. 启用智能缓存失效
3. 调整缓存有效期为更短时间（如2-4小时）

## 最佳实践

1. **定期验证**
   - 每天开始工作前进行快速检查
   - 发现异常时立即验证

2. **关键日期验证**
   - 今天和昨天的数据最重要
   - 使用详细模式验证

3. **自动健康检查**
   - 启用自动检查功能（每10分钟）
   - 及时关注健康状态指示器

4. **问题处理流程**
   ```
   发现问题 → 快速检查 → 查看详情 → 
   尝试自动修复 → 仍有问题 → 强制刷新 → 
   重新验证 → 确认解决
   ```

## 验证报告示例

```json
{
  "date": "2025-10-11",
  "pointId": 175,
  "timestamp": "2025-10-13T10:30:00.000Z",
  "checks": [
    {
      "name": "data_count",
      "status": "passed",
      "message": "数据量一致: 缓存 79 条 = API 79 条",
      "details": {
        "cachedCount": 79,
        "apiTotal": 79,
        "difference": 0,
        "differencePercent": 0
      }
    },
    {
      "name": "timestamps",
      "status": "passed",
      "message": "时间戳一致",
      "details": {
        "cachedLatest": "2025-10-11T11:44:21.000Z",
        "apiLatest": "2025-10-11T11:44:21.000Z",
        "timeDiffMinutes": 0
      }
    }
  ],
  "summary": {
    "passed": 6,
    "failed": 0,
    "warnings": 0
  }
}
```

## 技术支持

如果遇到以下情况，请查看系统日志：
- 验证过程卡住不动
- 报告显示异常错误
- 数据持续不一致

日志查看方法：
1. 打开浏览器控制台（F12）
2. 切换到 Console 标签
3. 搜索带有 🔍 或 ❌ 标记的日志

