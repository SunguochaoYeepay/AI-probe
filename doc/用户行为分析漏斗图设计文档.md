# ç”¨æˆ·è¡Œä¸ºåˆ†ææ¼æ–—å›¾è®¾è®¡æ–‡æ¡£

## 1. éœ€æ±‚åˆ†æ

### 1.1 åŠŸèƒ½éœ€æ±‚
åŸºäºç”¨æˆ·æä¾›çš„æˆªå›¾ï¼Œéœ€è¦å®ç°ä¸€ä¸ªå¤æ‚çš„ç”¨æˆ·è¡Œä¸ºåˆ†ææ¼æ–—å›¾ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š

- **æµç¨‹æ­¥éª¤å±•ç¤º**ï¼šæ˜¾ç¤ºç”¨æˆ·è¡Œä¸ºçš„å…³é”®æ­¥éª¤
- **æ•°æ®ç»Ÿè®¡**ï¼šæ¯ä¸ªæ­¥éª¤çš„å‚ä¸äººæ•°å’Œè½¬åŒ–ç‡
- **æ—¶é—´ä¿¡æ¯**ï¼šæ¯ä¸ªæ­¥éª¤çš„è€—æ—¶ç»Ÿè®¡
- **å¯è§†åŒ–æ•ˆæœ**ï¼šæ¼æ–—å›¾å½¢å¼å±•ç¤ºè½¬åŒ–è¿‡ç¨‹

### 1.2 å…·ä½“ç¤ºä¾‹
ä»æˆªå›¾å¯ä»¥çœ‹åˆ°çš„æ¼æ–—å›¾ç»“æ„ï¼š
```
æ¼æ–—å›¾_æˆåŠŸç‡ä¸è½¬åŒ–æ—¶é•¿

å·¦ä¾§æµç¨‹æ­¥éª¤ï¼š
- ç¬¬ä¸€æ­¥ï¼šæµç¨‹å¼€å§‹ (15åˆ†é’Ÿ)
- ç¬¬äºŒæ­¥ï¼šå‘èµ·ä½™é¢åˆ†è´¦ (15åˆ†é’Ÿ)  
- ç¬¬äºŒæ­¥ï¼šå®Œæˆåˆ†è´¦ (5åˆ†é’Ÿ)

å³ä¾§æ•°æ®å±•ç¤ºï¼š
- æµç¨‹å¼€å§‹ï¼š500 (100%)
- å‘èµ·ä½™é¢åˆ†è´¦ï¼š100 (20%)
- å®Œæˆåˆ†è´¦ï¼š100 (10%)
```

### 1.3 æ ¸å¿ƒåŠŸèƒ½ç‚¹
1. **ç”¨æˆ·è¡Œä¸ºè·¯å¾„åˆ†æ**ï¼šè¿½è¸ªç”¨æˆ·åœ¨åº”ç”¨ä¸­çš„è¡Œä¸ºåºåˆ—
2. **è½¬åŒ–ç‡è®¡ç®—**ï¼šè®¡ç®—æ¯ä¸ªæ­¥éª¤ç›¸å¯¹äºèµ·å§‹æ­¥éª¤çš„è½¬åŒ–ç‡
3. **æ—¶é—´ç»Ÿè®¡**ï¼šç»Ÿè®¡æ¯ä¸ªæ­¥éª¤çš„å¹³å‡è€—æ—¶
4. **æ™ºèƒ½è¯†åˆ«**ï¼šAIè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¡Œä¸ºæµç¨‹
5. **è‡ªå®šä¹‰é…ç½®**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æµç¨‹æ­¥éª¤

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„
```
ç”¨æˆ·è¾“å…¥éœ€æ±‚ â†’ AIéœ€æ±‚è§£æ â†’ æ•°æ®è·å– â†’ è¡Œä¸ºåˆ†æ â†’ æ¼æ–—å›¾ç”Ÿæˆ â†’ å¯è§†åŒ–å±•ç¤º
```

### 2.2 æ ¸å¿ƒç»„ä»¶

#### 2.2.1 æ•°æ®å¤„ç†å™¨å±‚
- **BehaviorAnalysisDataProcessor**ï¼šç”¨æˆ·è¡Œä¸ºåˆ†ææ•°æ®å¤„ç†å™¨
- **FunnelDataProcessor**ï¼šæ¼æ–—å›¾æ•°æ®å¤„ç†å™¨
- **TimeAnalysisProcessor**ï¼šæ—¶é—´åˆ†æå¤„ç†å™¨

#### 2.2.2 å›¾è¡¨ç”Ÿæˆå±‚
- **BehaviorFunnelGenerator**ï¼šè¡Œä¸ºæ¼æ–—å›¾ç”Ÿæˆå™¨
- **ConversionFunnelGenerator**ï¼šè½¬åŒ–æ¼æ–—å›¾ç”Ÿæˆå™¨
- **TimeFunnelGenerator**ï¼šæ—¶é—´æ¼æ–—å›¾ç”Ÿæˆå™¨

#### 2.2.3 AIåˆ†æå±‚
- **BehaviorRequirementParser**ï¼šè¡Œä¸ºéœ€æ±‚è§£æå™¨
- **FlowStepExtractor**ï¼šæµç¨‹æ­¥éª¤æå–å™¨
- **ConversionAnalyzer**ï¼šè½¬åŒ–åˆ†æå™¨

## 3. æ•°æ®æ¨¡å‹è®¾è®¡

### 3.1 åŒåŸ‹ç‚¹æ•°æ®æ¨¡å‹
åŸºäºç°æœ‰ç³»ç»Ÿçš„åŸ‹ç‚¹æ¶æ„ï¼Œæ¼æ–—å›¾éœ€è¦æ•´åˆä¸¤ç§ç±»å‹çš„æ•°æ®ï¼š

#### 3.1.1 ç”¨æˆ·è®¿é—®åŸ‹ç‚¹æ•°æ®
```javascript
// é¡µé¢è®¿é—®è®°å½• (visitBuryPointId) - åŸºäºçœŸå®æ•°æ®ç»“æ„
{
  "id": 1954,
  "pageName": "ä¸‹çº§å•†æˆ·æŸ¥è¯¢-appid é…ç½®",
  "type": "é¡µé¢",
  "stayTime": "0", // åœç•™æ—¶é—´(ç§’)
  "pageBehavior": "æ‰“å¼€", // é¡µé¢è¡Œä¸ºï¼šæ‰“å¼€/å…³é—­
  "weCustomerKey": "a2c03b17-e750-474d-bea0-8d62c5ecb95a-20251010195724499", // ç”¨æˆ·å”¯ä¸€æ ‡è¯†
  "weUserId": "10091337639", // ç”¨æˆ·ID
  "wePath": "https://mp.yeepay.com/mp-galaxy/mp-merchant-access/#/standardMerchantManage/queryMerchant/aggregatePaySetting",
  "weDeviceName": "PC",
  "wePlatform": "Win32",
  "weSystem": "web",
  "weOs": "web",
  "weBrowserName": "chrome",
  "weNewStatus": 2,
  "weIp": "10.201.77.173",
  "weCountry": "0",
  "weProvince": "0",
  "weCity": "å†…ç½‘IP",
  "createdAt": "2025-10-23T01:28:25.000Z"
}
```

#### 3.1.2 æŒ‰é’®ç‚¹å‡»åŸ‹ç‚¹æ•°æ®
```javascript
// æŒ‰é’®ç‚¹å‡»è®°å½• (clickBuryPointId) - åŸºäºçœŸå®æ•°æ®ç»“æ„
{
  "id": 7645,
  "pageName": "ä¼ä¸šä»˜æ¬¾-å¤æ ¸ç”³è¯·æŸ¥è¯¢",
  "type": "query", // ç‚¹å‡»ç±»å‹ï¼šquery(æŸ¥è¯¢)ã€click(ç‚¹å‡»)ç­‰
  "content": "{\"ç”³è¯·æ—¶é—´\":\"å…¶ä»–\",\"çŠ¶æ€\":\"å…¨éƒ¨\"}", // ç‚¹å‡»å†…å®¹ï¼Œå¯èƒ½æ˜¯JSONæ ¼å¼
  "weCustomerKey": "7fabd6dd-e0ab-4bc5-a1de-a7c37f66b12b-20240918130427138", // ç”¨æˆ·å”¯ä¸€æ ‡è¯†
  "weUserId": "10090768861", // ç”¨æˆ·ID
  "wePath": "https://mp.yeepay.com/mp-galaxy/mp-boss-fundmanage/#/companyPay/apply",
  "weDeviceName": "PC",
  "wePlatform": "Win32",
  "weSystem": "web",
  "weOs": "web",
  "weBrowserName": "chrome",
  "weNewStatus": 2,
  "weIp": "10.201.73.202",
  "weCountry": "0",
  "weProvince": "0",
  "weCity": "å†…ç½‘IP",
  "createdAt": "2025-10-22T06:27:47.000Z"
}
```

#### 3.1.3 ç”¨æˆ·è¡Œä¸ºè·¯å¾„æ•°æ®æ¨¡å‹
```javascript
// æ•´åˆåçš„ç”¨æˆ·è¡Œä¸ºè·¯å¾„ - åŸºäºçœŸå®æ•°æ®ç»“æ„
{
  weCustomerKey: "a2c03b17-e750-474d-bea0-8d62c5ecb95a-20251010195724499",
  weUserId: "10091337639",
  behaviorPath: [
    {
      step: 1,
      stepName: "æµç¨‹å¼€å§‹",
      actionType: "visit", // visit(é¡µé¢è®¿é—®) æˆ– click(æŒ‰é’®ç‚¹å‡»)
      pageName: "ä¸‹çº§å•†æˆ·æŸ¥è¯¢-appid é…ç½®",
      content: null, // è®¿é—®æ—¶ä¸ºç©ºï¼Œç‚¹å‡»æ—¶ä¸ºæŒ‰é’®å†…å®¹
      type: "é¡µé¢", // åŸå§‹typeå­—æ®µ
      pageBehavior: "æ‰“å¼€", // é¡µé¢è¡Œä¸º
      stayTime: "0", // åœç•™æ—¶é—´
      timestamp: "2025-10-23T01:28:25.000Z",
      wePath: "https://mp.yeepay.com/mp-galaxy/mp-merchant-access/#/standardMerchantManage/queryMerchant/aggregatePaySetting"
    },
    {
      step: 2,
      stepName: "å‘èµ·æŸ¥è¯¢æ“ä½œ", 
      actionType: "click",
      pageName: "ä¼ä¸šä»˜æ¬¾-å¤æ ¸ç”³è¯·æŸ¥è¯¢",
      content: "{\"ç”³è¯·æ—¶é—´\":\"å…¶ä»–\",\"çŠ¶æ€\":\"å…¨éƒ¨\"}", // JSONæ ¼å¼çš„æŸ¥è¯¢æ¡ä»¶
      type: "query", // åŸå§‹typeå­—æ®µ
      timestamp: "2025-10-22T06:27:47.000Z",
      wePath: "https://mp.yeepay.com/mp-galaxy/mp-boss-fundmanage/#/companyPay/apply"
    },
    {
      step: 3,
      stepName: "å®Œæˆæ“ä½œ",
      actionType: "visit", 
      pageName: "ä¸‹çº§å•†æˆ·æŸ¥è¯¢-appid é…ç½®",
      content: null,
      type: "é¡µé¢",
      pageBehavior: "å…³é—­", // é¡µé¢å…³é—­
      stayTime: "11", // åœç•™11ç§’
      timestamp: "2025-10-23T01:28:35.000Z",
      wePath: "https://mp.yeepay.com/mp-galaxy/mp-merchant-access/#/standardMerchantManage/queryMerchant"
    }
  ],
  totalDuration: 10, // æ€»è€—æ—¶(ç§’) - ä»ç¬¬ä¸€ä¸ªæ‰“å¼€åˆ°æœ€åä¸€ä¸ªå…³é—­
  isCompleted: true, // æ˜¯å¦å®Œæˆæ•´ä¸ªæµç¨‹
  deviceInfo: {
    weDeviceName: "PC",
    wePlatform: "Win32",
    weSystem: "web",
    weOs: "web",
    weBrowserName: "chrome"
  }
}
```

### 3.2 æµç¨‹æ­¥éª¤æ•°æ®æ¨¡å‹
```javascript
// æµç¨‹æ­¥éª¤å®šä¹‰
{
  stepId: "step_1",
  stepName: "æµç¨‹å¼€å§‹",
  stepType: "entry", // entry, process, exit
  expectedDuration: 15, // åˆ†é’Ÿ
  description: "ç”¨æˆ·è¿›å…¥æµç¨‹çš„èµ·å§‹æ­¥éª¤"
}
```

### 3.3 æ¼æ–—å›¾æ•°æ®æ¨¡å‹
```javascript
// æ¼æ–—å›¾æ•°æ®
{
  funnelId: "funnel_123",
  funnelName: "ä½™é¢åˆ†è´¦æµç¨‹",
  steps: [
    {
      stepId: "step_1",
      stepName: "æµç¨‹å¼€å§‹",
      participantCount: 500,
      conversionRate: 100, // ç›¸å¯¹äºèµ·å§‹æ­¥éª¤çš„ç™¾åˆ†æ¯”
      averageDuration: 15, // åˆ†é’Ÿ
      timeRange: "2025-01-01 åˆ° 2025-01-07"
    },
    {
      stepId: "step_2", 
      stepName: "å‘èµ·ä½™é¢åˆ†è´¦",
      participantCount: 100,
      conversionRate: 20,
      averageDuration: 15,
      timeRange: "2025-01-01 åˆ° 2025-01-07"
    },
    {
      stepId: "step_3",
      stepName: "å®Œæˆåˆ†è´¦", 
      participantCount: 100,
      conversionRate: 10,
      averageDuration: 5,
      timeRange: "2025-01-01 åˆ° 2025-01-07"
    }
  ],
  totalParticipants: 500,
  overallConversionRate: 10,
  averageTotalDuration: 35 // åˆ†é’Ÿ
}
```

## 4. æ ¸å¿ƒç®—æ³•è®¾è®¡

### 4.1 åŒåŸ‹ç‚¹æ•°æ®ç»„ç»‡ç®—æ³•
è¿™æ˜¯æœ€å…³é”®çš„éƒ¨åˆ†ï¼Œéœ€è¦å°†è®¿é—®åŸ‹ç‚¹å’Œç‚¹å‡»åŸ‹ç‚¹æ•°æ®æ•´åˆæˆç”¨æˆ·è¡Œä¸ºè·¯å¾„ï¼š

```javascript
class DualBuryPointDataOrganizer {
  /**
   * æ•´åˆè®¿é—®åŸ‹ç‚¹å’Œç‚¹å‡»åŸ‹ç‚¹æ•°æ®
   * @param {Array} visitData - è®¿é—®åŸ‹ç‚¹æ•°æ®
   * @param {Array} clickData - ç‚¹å‡»åŸ‹ç‚¹æ•°æ®
   * @returns {Array} ç”¨æˆ·è¡Œä¸ºè·¯å¾„æ•°ç»„
   */
  organizeUserBehaviorPaths(visitData, clickData) {
    // 1. æŒ‰ç”¨æˆ·åˆ†ç»„æ‰€æœ‰æ•°æ®
    const userDataMap = new Map();
    
    // å¤„ç†è®¿é—®æ•°æ®
    visitData.forEach(record => {
      const userKey = record.weCustomerKey;
      if (!userDataMap.has(userKey)) {
        userDataMap.set(userKey, {
          weCustomerKey: userKey,
          weUserId: record.weUserId,
          actions: [],
          deviceInfo: {
            weDeviceName: record.weDeviceName,
            wePlatform: record.wePlatform,
            weSystem: record.weSystem,
            weOs: record.weOs,
            weBrowserName: record.weBrowserName
          }
        });
      }
      
      userDataMap.get(userKey).actions.push({
        type: 'visit',
        pageName: record.pageName,
        pageBehavior: record.pageBehavior,
        stayTime: record.stayTime,
        timestamp: new Date(record.createdAt),
        wePath: record.wePath,
        originalData: record
      });
    });
    
    // å¤„ç†ç‚¹å‡»æ•°æ®
    clickData.forEach(record => {
      const userKey = record.weCustomerKey;
      if (!userDataMap.has(userKey)) {
        userDataMap.set(userKey, {
          weCustomerKey: userKey,
          weUserId: record.weUserId,
          actions: [],
          deviceInfo: {
            weDeviceName: record.weDeviceName,
            wePlatform: record.wePlatform,
            weSystem: record.weSystem,
            weOs: record.weOs,
            weBrowserName: record.weBrowserName
          }
        });
      }
      
      userDataMap.get(userKey).actions.push({
        type: 'click',
        pageName: record.pageName,
        content: record.content,
        clickType: record.type, // query, clickç­‰
        timestamp: new Date(record.createdAt),
        wePath: record.wePath,
        originalData: record
      });
    });
    
    // 2. ä¸ºæ¯ä¸ªç”¨æˆ·æ„å»ºè¡Œä¸ºè·¯å¾„
    const userPaths = [];
    userDataMap.forEach((userData, userKey) => {
      // æŒ‰æ—¶é—´æ’åºæ‰€æœ‰è¡Œä¸º
      userData.actions.sort((a, b) => a.timestamp - b.timestamp);
      
      // æ„å»ºè¡Œä¸ºè·¯å¾„
      const behaviorPath = this.buildBehaviorPath(userData.actions);
      
      userPaths.push({
        weCustomerKey: userKey,
        weUserId: userData.weUserId,
        behaviorPath: behaviorPath,
        totalDuration: this.calculateTotalDuration(behaviorPath),
        isCompleted: this.isPathCompleted(behaviorPath),
        deviceInfo: userData.deviceInfo
      });
    });
    
    return userPaths;
  }
  
  /**
   * æ„å»ºç”¨æˆ·è¡Œä¸ºè·¯å¾„
   * @param {Array} actions - æŒ‰æ—¶é—´æ’åºçš„ç”¨æˆ·è¡Œä¸º
   * @returns {Array} è¡Œä¸ºè·¯å¾„
   */
  buildBehaviorPath(actions) {
    const path = [];
    let stepCounter = 1;
    
    for (let i = 0; i < actions.length; i++) {
      const action = actions[i];
      const nextAction = actions[i + 1];
      
      // è¯†åˆ«æ­¥éª¤åç§°
      const stepName = this.identifyStepName(action, nextAction);
      
      path.push({
        step: stepCounter++,
        stepName: stepName,
        actionType: action.type,
        pageName: action.pageName,
        content: action.content || null,
        type: action.clickType || 'é¡µé¢',
        pageBehavior: action.pageBehavior || null,
        stayTime: action.stayTime || null,
        timestamp: action.timestamp.toISOString(),
        wePath: action.wePath,
        originalData: action.originalData
      });
    }
    
    return path;
  }
  
  /**
   * è¯†åˆ«æ­¥éª¤åç§°
   * @param {Object} currentAction - å½“å‰è¡Œä¸º
   * @param {Object} nextAction - ä¸‹ä¸€ä¸ªè¡Œä¸º
   * @returns {String} æ­¥éª¤åç§°
   */
  identifyStepName(currentAction, nextAction) {
    if (currentAction.type === 'visit') {
      if (currentAction.pageBehavior === 'æ‰“å¼€') {
        return 'æµç¨‹å¼€å§‹';
      } else if (currentAction.pageBehavior === 'å…³é—­') {
        return 'æµç¨‹ç»“æŸ';
      } else {
        return `è®¿é—®${currentAction.pageName}`;
      }
    } else if (currentAction.type === 'click') {
      // å°è¯•ä»contentä¸­æå–æ“ä½œåç§°
      if (currentAction.content) {
        try {
          const contentObj = JSON.parse(currentAction.content);
          if (contentObj.ç”³è¯·æ—¶é—´ || contentObj.çŠ¶æ€) {
            return 'å‘èµ·æŸ¥è¯¢æ“ä½œ';
          }
        } catch (e) {
          // å¦‚æœä¸æ˜¯JSONï¼Œç›´æ¥ä½¿ç”¨content
          return currentAction.content;
        }
      }
      return `ç‚¹å‡»æ“ä½œ`;
    }
    
    return 'æœªçŸ¥æ­¥éª¤';
  }
  
  /**
   * è®¡ç®—æ€»è€—æ—¶
   * @param {Array} behaviorPath - è¡Œä¸ºè·¯å¾„
   * @returns {Number} æ€»è€—æ—¶(ç§’)
   */
  calculateTotalDuration(behaviorPath) {
    if (behaviorPath.length < 2) return 0;
    
    const startTime = new Date(behaviorPath[0].timestamp);
    const endTime = new Date(behaviorPath[behaviorPath.length - 1].timestamp);
    
    return Math.floor((endTime - startTime) / 1000); // è½¬æ¢ä¸ºç§’
  }
  
  /**
   * åˆ¤æ–­è·¯å¾„æ˜¯å¦å®Œæˆ
   * @param {Array} behaviorPath - è¡Œä¸ºè·¯å¾„
   * @returns {Boolean} æ˜¯å¦å®Œæˆ
   */
  isPathCompleted(behaviorPath) {
    // ç®€å•åˆ¤æ–­ï¼šå¦‚æœæœ‰æ‰“å¼€å’Œå…³é—­æ“ä½œï¼Œè®¤ä¸ºå®Œæˆ
    const hasOpen = behaviorPath.some(step => step.pageBehavior === 'æ‰“å¼€');
    const hasClose = behaviorPath.some(step => step.pageBehavior === 'å…³é—­');
    
    return hasOpen && hasClose;
  }
}
```

### 4.2 ç”¨æˆ·è¡Œä¸ºè·¯å¾„åˆ†æç®—æ³•
```javascript
class BehaviorPathAnalyzer {
  // åˆ†æç”¨æˆ·è¡Œä¸ºè·¯å¾„
  analyzeUserPath(userActions) {
    // 1. æŒ‰æ—¶é—´æ’åºç”¨æˆ·è¡Œä¸º
    // 2. è¯†åˆ«å…³é”®è¡Œä¸ºèŠ‚ç‚¹
    // 3. è®¡ç®—æ­¥éª¤é—´çš„æ—¶é—´é—´éš”
    // 4. ç»Ÿè®¡æ¯ä¸ªæ­¥éª¤çš„å‚ä¸äººæ•°
  }
  
  // è¯†åˆ«æµç¨‹æ­¥éª¤
  identifyFlowSteps(actions) {
    // 1. ä½¿ç”¨AIè¯†åˆ«å…³é”®æ­¥éª¤
    // 2. åŸºäºè¡Œä¸ºæ¨¡å¼åŒ¹é…
    // 3. æ”¯æŒè‡ªå®šä¹‰æ­¥éª¤å®šä¹‰
  }
}
```

### 4.2 è½¬åŒ–ç‡è®¡ç®—ç®—æ³•
```javascript
class ConversionRateCalculator {
  // è®¡ç®—è½¬åŒ–ç‡
  calculateConversionRate(stepData) {
    const baseCount = stepData[0].participantCount;
    return stepData.map(step => ({
      ...step,
      conversionRate: (step.participantCount / baseCount) * 100
    }));
  }
  
  // è®¡ç®—æ­¥éª¤é—´è½¬åŒ–ç‡
  calculateStepConversionRate(currentStep, previousStep) {
    return (currentStep.participantCount / previousStep.participantCount) * 100;
  }
}
```

### 4.3 æ—¶é—´åˆ†æç®—æ³•
```javascript
class TimeAnalyzer {
  // è®¡ç®—å¹³å‡è€—æ—¶
  calculateAverageDuration(actions, stepDefinition) {
    // 1. è¯†åˆ«æ­¥éª¤å¼€å§‹å’Œç»“æŸæ—¶é—´
    // 2. è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„æ­¥éª¤è€—æ—¶
    // 3. è®¡ç®—å¹³å‡è€—æ—¶
  }
  
  // åˆ†ææ—¶é—´åˆ†å¸ƒ
  analyzeTimeDistribution(durations) {
    // 1. è®¡ç®—ä¸­ä½æ•°ã€å››åˆ†ä½æ•°
    // 2. è¯†åˆ«å¼‚å¸¸å€¼
    // 3. ç”Ÿæˆæ—¶é—´åˆ†å¸ƒç»Ÿè®¡
  }
}
```

## 5. AIé›†æˆè®¾è®¡

### 5.1 éœ€æ±‚è§£ææç¤ºè¯
```javascript
const BEHAVIOR_ANALYSIS_PROMPT = `
ä½ æ˜¯ä¸€ä¸ªç”¨æˆ·è¡Œä¸ºåˆ†æä¸“å®¶ã€‚è¯·åˆ†æç”¨æˆ·çš„éœ€æ±‚ï¼Œè¯†åˆ«ç”¨æˆ·æƒ³è¦åˆ†æçš„è¡Œä¸ºæµç¨‹ã€‚

ç”¨æˆ·éœ€æ±‚ï¼š"{userRequirement}"

è¯·è¿”å›JSONæ ¼å¼çš„åˆ†æç»“æœï¼š
{
  "intent": "behavior_funnel_analysis",
  "chartType": "behavior_funnel",
  "description": "ç”¨æˆ·è¡Œä¸ºè½¬åŒ–æ¼æ–—åˆ†æ",
  "flowSteps": [
    {
      "stepName": "æ­¥éª¤åç§°",
      "stepType": "entry|process|exit",
      "keywords": ["å…³é”®è¯1", "å…³é”®è¯2"],
      "expectedDuration": 15
    }
  ],
  "confidence": 0.95
}
`;
```

### 5.2 æµç¨‹æ­¥éª¤è¯†åˆ«
```javascript
const FLOW_STEP_EXTRACTION_PROMPT = `
åŸºäºç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œè¯†åˆ«å…³é”®çš„ä¸šåŠ¡æµç¨‹æ­¥éª¤ã€‚

è¡Œä¸ºæ•°æ®ï¼š{behaviorData}

è¯·è¯†åˆ«å‡ºå®Œæ•´çš„ä¸šåŠ¡æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š
1. æµç¨‹èµ·å§‹æ­¥éª¤
2. ä¸­é—´å¤„ç†æ­¥éª¤  
3. æµç¨‹ç»“æŸæ­¥éª¤

è¿”å›JSONæ ¼å¼ï¼š
{
  "flowName": "æµç¨‹åç§°",
  "steps": [
    {
      "stepName": "æ­¥éª¤åç§°",
      "stepOrder": 1,
      "triggerActions": ["action1", "action2"],
      "pageNames": ["page1", "page2"]
    }
  ]
}
`;
```

## 6. å›¾è¡¨ç”Ÿæˆè®¾è®¡

### 6.1 æ¼æ–—å›¾é…ç½®
åŸºäºçœŸå®æ•°æ®ç»“æ„çš„æ¼æ–—å›¾ç”Ÿæˆï¼š

```javascript
const generateBehaviorFunnelOption = (funnelData) => {
  return {
    title: {
      text: funnelData.funnelName || 'ç”¨æˆ·è¡Œä¸ºè½¬åŒ–æ¼æ–—',
      subtext: `æ€»å‚ä¸äººæ•°: ${funnelData.totalParticipants} | æ•´ä½“è½¬åŒ–ç‡: ${funnelData.overallConversionRate}%`,
      left: 'center',
      textStyle: {
        fontSize: 18,
        fontWeight: 'bold'
      }
    },
    tooltip: {
      trigger: 'item',
      formatter: function(params) {
        const step = funnelData.steps[params.dataIndex];
        return `
          <div style="padding: 10px;">
            <strong style="color: #1890ff;">${step.stepName}</strong><br/>
            <span style="color: #666;">å‚ä¸äººæ•°: </span><strong>${step.participantCount}</strong><br/>
            <span style="color: #666;">è½¬åŒ–ç‡: </span><strong style="color: #52c41a;">${step.conversionRate}%</strong><br/>
            <span style="color: #666;">å¹³å‡è€—æ—¶: </span><strong style="color: #faad14;">${step.averageDuration}ç§’</strong>
          </div>
        `;
      }
    },
    series: [{
      name: 'è¡Œä¸ºè½¬åŒ–æ¼æ–—',
      type: 'funnel',
      left: '10%',
      top: 80,
      bottom: 60,
      width: '80%',
      min: 0,
      max: funnelData.totalParticipants,
      minSize: '0%',
      maxSize: '100%',
      sort: 'descending',
      gap: 2,
      label: {
        show: true,
        position: 'inside',
        formatter: function(params) {
          const step = funnelData.steps[params.dataIndex];
          return `${step.stepName}\n${step.participantCount} (${step.conversionRate}%)`;
        },
        fontSize: 12,
        fontWeight: 'bold',
        color: '#fff'
      },
      labelLine: {
        length: 10,
        lineStyle: {
          width: 1,
          type: 'solid'
        }
      },
      itemStyle: {
        borderColor: '#fff',
        borderWidth: 2
      },
      emphasis: {
        label: {
          fontSize: 14
        },
        itemStyle: {
          shadowBlur: 10,
          shadowColor: 'rgba(0, 0, 0, 0.3)'
        }
      },
      data: funnelData.steps.map((step, index) => ({
        value: step.participantCount,
        name: step.stepName,
        itemStyle: {
          color: getStepColor(index)
        }
      }))
    }],
    // æ·»åŠ æ—¶é—´ä¿¡æ¯æ˜¾ç¤º
    graphic: funnelData.steps.map((step, index) => ({
      type: 'text',
      left: '85%',
      top: `${80 + (index * 15)}%`,
      style: {
        text: `${step.averageDuration}ç§’`,
        fontSize: 12,
        fill: '#666',
        fontWeight: 'bold'
      }
    }))
  };
};

// æ­¥éª¤é¢œè‰²é…ç½®
const getStepColor = (index) => {
  const colors = [
    '#1890ff', // è“è‰² - æµç¨‹å¼€å§‹
    '#52c41a', // ç»¿è‰² - ä¸­é—´æ­¥éª¤
    '#faad14', // æ©™è‰² - å…³é”®æ­¥éª¤
    '#f5222d', // çº¢è‰² - ç»“æŸæ­¥éª¤
    '#722ed1', // ç´«è‰² - å…¶ä»–æ­¥éª¤
    '#13c2c2', // é’è‰²
    '#eb2f96', // ç²‰è‰²
    '#fa8c16'  // æ·±æ©™è‰²
  ];
  return colors[index % colors.length];
};
```

### 6.2 åŸºäºçœŸå®æ•°æ®çš„æ¼æ–—å›¾ç”Ÿæˆç¤ºä¾‹
```javascript
// åŸºäºä½ æä¾›çš„ç¤ºä¾‹æ•°æ®ç”Ÿæˆçš„æ¼æ–—å›¾æ•°æ®
const exampleFunnelData = {
  funnelId: "funnel_merchant_query",
  funnelName: "å•†æˆ·æŸ¥è¯¢æµç¨‹è½¬åŒ–æ¼æ–—",
  steps: [
    {
      stepId: "step_1",
      stepName: "æµç¨‹å¼€å§‹",
      participantCount: 500, // å‡è®¾æœ‰500ä¸ªç”¨æˆ·å¼€å§‹æµç¨‹
      conversionRate: 100, // èµ·å§‹æ­¥éª¤100%
      averageDuration: 0, // å¼€å§‹æ—¶é—´
      timeRange: "2025-10-22 åˆ° 2025-10-23",
      description: "ç”¨æˆ·è®¿é—®ä¸‹çº§å•†æˆ·æŸ¥è¯¢é¡µé¢"
    },
    {
      stepId: "step_2", 
      stepName: "å‘èµ·æŸ¥è¯¢æ“ä½œ",
      participantCount: 100, // 100ä¸ªç”¨æˆ·è¿›è¡Œäº†æŸ¥è¯¢æ“ä½œ
      conversionRate: 20, // 20%çš„è½¬åŒ–ç‡
      averageDuration: 15, // å¹³å‡15ç§’åå‘èµ·æŸ¥è¯¢
      timeRange: "2025-10-22 åˆ° 2025-10-23",
      description: "ç”¨æˆ·ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®ï¼Œè®¾ç½®æŸ¥è¯¢æ¡ä»¶"
    },
    {
      stepId: "step_3",
      stepName: "å®Œæˆæ“ä½œ", 
      participantCount: 100, // 100ä¸ªç”¨æˆ·å®Œæˆäº†æ“ä½œ
      conversionRate: 20, // ç›¸å¯¹äºèµ·å§‹æ­¥éª¤çš„è½¬åŒ–ç‡
      averageDuration: 10, // å¹³å‡10ç§’å®Œæˆæ“ä½œ
      timeRange: "2025-10-22 åˆ° 2025-10-23",
      description: "ç”¨æˆ·å®ŒæˆæŸ¥è¯¢å¹¶å…³é—­é¡µé¢"
    }
  ],
  totalParticipants: 500,
  overallConversionRate: 20, // æ•´ä½“è½¬åŒ–ç‡20%
  averageTotalDuration: 25 // å¹³å‡æ€»è€—æ—¶25ç§’
};
```

### 6.2 æ—¶é—´ä¿¡æ¯å±•ç¤º
```javascript
const addTimeInfoToFunnel = (option, funnelData) => {
  // åœ¨æ¼æ–—å›¾å³ä¾§æ·»åŠ æ—¶é—´ä¿¡æ¯
  option.graphic = funnelData.steps.map((step, index) => ({
    type: 'text',
    left: '85%',
    top: `${60 + (index * 20)}%`,
    style: {
      text: `${step.averageDuration}åˆ†é’Ÿ`,
      fontSize: 12,
      fill: '#666'
    }
  }));
  
  return option;
};
```

## 7. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 7.1 è¡Œä¸ºåˆ†ææ¨¡å¼ç•Œé¢
åœ¨ç°æœ‰çš„è¡Œä¸ºåˆ†ææ¨¡å¼ä¸‹ï¼Œæ·»åŠ æ¼æ–—å›¾é€‰é¡¹ï¼š

```javascript
// åœ¨AIChatInterface.vueä¸­æ·»åŠ 
const behaviorAnalysisOptions = [
  { 
    text: 'ğŸ¯ è¡Œä¸ºè½¬åŒ–æ¼æ–—', 
    type: 'select_analysis', 
    params: { 
      type: 'behavior_funnel', 
      description: 'åˆ†æç”¨æˆ·è¡Œä¸ºè½¬åŒ–æ¼æ–—å’Œå…³é”®èŠ‚ç‚¹' 
    } 
  },
  { 
    text: 'â±ï¸ æ—¶é—´æ¼æ–—åˆ†æ', 
    type: 'select_analysis', 
    params: { 
      type: 'time_funnel', 
      description: 'åˆ†æç”¨æˆ·è¡Œä¸ºå„æ­¥éª¤çš„æ—¶é—´åˆ†å¸ƒ' 
    } 
  },
  { 
    text: 'ğŸ“Š è‡ªå®šä¹‰æµç¨‹æ¼æ–—', 
    type: 'select_analysis', 
    params: { 
      type: 'custom_funnel', 
      description: 'è‡ªå®šä¹‰ç”¨æˆ·è¡Œä¸ºæµç¨‹è¿›è¡Œæ¼æ–—åˆ†æ' 
    } 
  }
];
```

### 7.2 æµç¨‹é…ç½®ç•Œé¢
```javascript
// æµç¨‹æ­¥éª¤é…ç½®ç»„ä»¶
const FlowStepConfig = {
  template: `
    <div class="flow-step-config">
      <h3>é…ç½®æµç¨‹æ­¥éª¤</h3>
      <div v-for="(step, index) in steps" :key="index" class="step-item">
        <a-input v-model="step.stepName" placeholder="æ­¥éª¤åç§°" />
        <a-input-number v-model="step.expectedDuration" placeholder="é¢„æœŸè€—æ—¶(åˆ†é’Ÿ)" />
        <a-button @click="removeStep(index)" type="danger">åˆ é™¤</a-button>
      </div>
      <a-button @click="addStep" type="primary">æ·»åŠ æ­¥éª¤</a-button>
    </div>
  `,
  data() {
    return {
      steps: [
        { stepName: 'æµç¨‹å¼€å§‹', expectedDuration: 15 },
        { stepName: 'å‘èµ·ä½™é¢åˆ†è´¦', expectedDuration: 15 },
        { stepName: 'å®Œæˆåˆ†è´¦', expectedDuration: 5 }
      ]
    }
  }
};
```

## 8. å®ç°è®¡åˆ’

### 8.1 ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°
1. **åˆ›å»ºæ•°æ®å¤„ç†å™¨**
   - å®ç° `BehaviorAnalysisDataProcessor`
   - å®ç°ç”¨æˆ·è¡Œä¸ºè·¯å¾„åˆ†æç®—æ³•
   - å®ç°è½¬åŒ–ç‡è®¡ç®—ç®—æ³•

2. **æ‰©å±•å›¾è¡¨ç”Ÿæˆå™¨**
   - æ·»åŠ  `generateBehaviorFunnelOption` æ–¹æ³•
   - å®ç°æ—¶é—´ä¿¡æ¯å±•ç¤º
   - å®ç°è‡ªå®šä¹‰æ¼æ–—å›¾é…ç½®

### 8.2 ç¬¬äºŒé˜¶æ®µï¼šAIé›†æˆ
1. **æ‰©å±•éœ€æ±‚è§£æå™¨**
   - æ·»åŠ è¡Œä¸ºåˆ†ææç¤ºè¯
   - å®ç°æµç¨‹æ­¥éª¤è¯†åˆ«
   - é›†æˆAIåˆ†æåŠŸèƒ½

2. **æ™ºèƒ½åˆ†æåŠŸèƒ½**
   - è‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¡Œä¸ºæµç¨‹
   - æ™ºèƒ½è®¡ç®—è½¬åŒ–ç‡
   - è‡ªåŠ¨ç”Ÿæˆæ¼æ–—å›¾

### 8.3 ç¬¬ä¸‰é˜¶æ®µï¼šç”¨æˆ·ç•Œé¢ä¼˜åŒ–
1. **ç•Œé¢é›†æˆ**
   - åœ¨è¡Œä¸ºåˆ†ææ¨¡å¼ä¸‹æ·»åŠ æ¼æ–—å›¾é€‰é¡¹
   - å®ç°æµç¨‹é…ç½®ç•Œé¢
   - æ·»åŠ æ—¶é—´èŒƒå›´é€‰æ‹©

2. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ·»åŠ äº¤äº’å¼é…ç½®
   - å®ç°å®æ—¶é¢„è§ˆ
   - æ·»åŠ å¯¼å‡ºåŠŸèƒ½

## 9. æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 9.1 åŒåŸ‹ç‚¹æ•°æ®æ•´åˆï¼ˆæ ¸å¿ƒéš¾ç‚¹ï¼‰
**éš¾ç‚¹**ï¼šå¦‚ä½•å°†è®¿é—®åŸ‹ç‚¹å’Œç‚¹å‡»åŸ‹ç‚¹æ•°æ®æ•´åˆæˆå®Œæ•´çš„ç”¨æˆ·è¡Œä¸ºè·¯å¾„
**å…·ä½“æŒ‘æˆ˜**ï¼š
- è®¿é—®æ•°æ®ï¼š`type: "é¡µé¢"`, `pageBehavior: "æ‰“å¼€/å…³é—­"`, `stayTime: "åœç•™æ—¶é—´"`
- ç‚¹å‡»æ•°æ®ï¼š`type: "query"`, `content: "JSONæ ¼å¼çš„æŸ¥è¯¢æ¡ä»¶"`
- éœ€è¦æŒ‰ `weCustomerKey` å’Œæ—¶é—´é¡ºåºæ•´åˆä¸¤ç§æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// 1. æ•°æ®é¢„å¤„ç†å’Œæ ‡å‡†åŒ–
const preprocessData = (visitData, clickData) => {
  // ç»Ÿä¸€æ—¶é—´æ ¼å¼
  const normalizeTimestamp = (record) => new Date(record.createdAt);
  
  // æ ‡å‡†åŒ–è®¿é—®æ•°æ®
  const normalizedVisitData = visitData.map(record => ({
    ...record,
    actionType: 'visit',
    normalizedTimestamp: normalizeTimestamp(record)
  }));
  
  // æ ‡å‡†åŒ–ç‚¹å‡»æ•°æ®
  const normalizedClickData = clickData.map(record => ({
    ...record,
    actionType: 'click',
    normalizedTimestamp: normalizeTimestamp(record)
  }));
  
  return { normalizedVisitData, normalizedClickData };
};

// 2. æŒ‰ç”¨æˆ·åˆ†ç»„å¹¶æ’åº
const groupByUser = (visitData, clickData) => {
  const userMap = new Map();
  
  // åˆå¹¶æ‰€æœ‰æ•°æ®
  const allData = [...visitData, ...clickData];
  
  // æŒ‰ç”¨æˆ·åˆ†ç»„
  allData.forEach(record => {
    const userKey = record.weCustomerKey;
    if (!userMap.has(userKey)) {
      userMap.set(userKey, []);
    }
    userMap.get(userKey).push(record);
  });
  
  // æŒ‰æ—¶é—´æ’åºæ¯ä¸ªç”¨æˆ·çš„è¡Œä¸º
  userMap.forEach(actions => {
    actions.sort((a, b) => a.normalizedTimestamp - b.normalizedTimestamp);
  });
  
  return userMap;
};
```

### 9.2 ç”¨æˆ·è¡Œä¸ºè·¯å¾„è¯†åˆ«
**éš¾ç‚¹**ï¼šå¦‚ä½•ä»æ··åˆçš„è®¿é—®å’Œç‚¹å‡»æ•°æ®ä¸­è¯†åˆ«å‡ºæœ‰æ„ä¹‰çš„ä¸šåŠ¡æµç¨‹
**å…·ä½“æŒ‘æˆ˜**ï¼š
- è®¿é—®æ•°æ®ä¸­çš„ `pageBehavior: "æ‰“å¼€/å…³é—­"` éœ€è¦æ­£ç¡®è¯†åˆ«
- ç‚¹å‡»æ•°æ®ä¸­çš„ `content` å­—æ®µæ˜¯JSONæ ¼å¼ï¼Œéœ€è¦è§£æ
- éœ€è¦æ™ºèƒ½è¯†åˆ«æ­¥éª¤åç§°å’Œæµç¨‹é€»è¾‘

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// æ™ºèƒ½æ­¥éª¤è¯†åˆ«ç®—æ³•
const identifyFlowSteps = (userActions) => {
  const steps = [];
  let stepCounter = 1;
  
  for (let i = 0; i < userActions.length; i++) {
    const action = userActions[i];
    const nextAction = userActions[i + 1];
    
    let stepName = 'æœªçŸ¥æ­¥éª¤';
    
    if (action.actionType === 'visit') {
      if (action.pageBehavior === 'æ‰“å¼€') {
        stepName = 'æµç¨‹å¼€å§‹';
      } else if (action.pageBehavior === 'å…³é—­') {
        stepName = 'æµç¨‹ç»“æŸ';
      } else {
        stepName = `è®¿é—®${action.pageName}`;
      }
    } else if (action.actionType === 'click') {
      // è§£æJSONæ ¼å¼çš„content
      try {
        const contentObj = JSON.parse(action.content);
        if (contentObj.ç”³è¯·æ—¶é—´ && contentObj.çŠ¶æ€) {
          stepName = 'å‘èµ·æŸ¥è¯¢æ“ä½œ';
        } else if (contentObj.çŠ¶æ€) {
          stepName = 'çŠ¶æ€ç­›é€‰';
        } else {
          stepName = 'ç‚¹å‡»æ“ä½œ';
        }
      } catch (e) {
        stepName = action.content || 'ç‚¹å‡»æ“ä½œ';
      }
    }
    
    steps.push({
      step: stepCounter++,
      stepName: stepName,
      actionType: action.actionType,
      pageName: action.pageName,
      content: action.content,
      timestamp: action.normalizedTimestamp,
      stayTime: action.stayTime
    });
  }
  
  return steps;
};
```

### 9.3 æ—¶é—´ç»Ÿè®¡å‡†ç¡®æ€§
**éš¾ç‚¹**ï¼šå¦‚ä½•å‡†ç¡®è®¡ç®—æ¯ä¸ªæ­¥éª¤çš„è€—æ—¶ï¼Œç‰¹åˆ«æ˜¯å¤„ç† `stayTime` å­—æ®µ
**å…·ä½“æŒ‘æˆ˜**ï¼š
- `stayTime` å­—æ®µæ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼Œéœ€è¦è½¬æ¢ä¸ºæ•°å­—
- éœ€è¦åŒºåˆ†é¡µé¢åœç•™æ—¶é—´å’Œæ­¥éª¤é—´çš„æ—¶é—´é—´éš”
- å¤„ç†å¼‚å¸¸æ—¶é—´æ•°æ®ï¼ˆå¦‚è´Ÿæ•°ã€è¿‡å¤§å€¼ç­‰ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// æ—¶é—´è®¡ç®—ç®—æ³•
const calculateStepDurations = (behaviorPath) => {
  return behaviorPath.map((step, index) => {
    let duration = 0;
    
    if (step.actionType === 'visit' && step.stayTime) {
      // ä½¿ç”¨é¡µé¢åœç•™æ—¶é—´
      duration = parseInt(step.stayTime) || 0;
    } else if (index < behaviorPath.length - 1) {
      // è®¡ç®—åˆ°ä¸‹ä¸€æ­¥çš„æ—¶é—´é—´éš”
      const currentTime = new Date(step.timestamp);
      const nextTime = new Date(behaviorPath[index + 1].timestamp);
      duration = Math.floor((nextTime - currentTime) / 1000); // è½¬æ¢ä¸ºç§’
    }
    
    return {
      ...step,
      duration: Math.max(0, duration), // ç¡®ä¿éè´Ÿæ•°
      durationFormatted: formatDuration(duration)
    };
  });
};

const formatDuration = (seconds) => {
  if (seconds < 60) {
    return `${seconds}ç§’`;
  } else if (seconds < 3600) {
    return `${Math.floor(seconds / 60)}åˆ†é’Ÿ${seconds % 60}ç§’`;
  } else {
    return `${Math.floor(seconds / 3600)}å°æ—¶${Math.floor((seconds % 3600) / 60)}åˆ†é’Ÿ`;
  }
};
```

### 9.4 è½¬åŒ–ç‡è®¡ç®—
**éš¾ç‚¹**ï¼šå¦‚ä½•å‡†ç¡®è®¡ç®—å„æ­¥éª¤é—´çš„è½¬åŒ–ç‡ï¼Œå¤„ç†æ•°æ®å¼‚å¸¸æƒ…å†µ
**å…·ä½“æŒ‘æˆ˜**ï¼š
- éœ€è¦åŸºäº `weCustomerKey` è¿›è¡Œç”¨æˆ·å»é‡
- å¤„ç†ä¸å®Œæ•´çš„ç”¨æˆ·è¡Œä¸ºè·¯å¾„
- è®¡ç®—ç›¸å¯¹äºèµ·å§‹æ­¥éª¤çš„è½¬åŒ–ç‡

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// è½¬åŒ–ç‡è®¡ç®—ç®—æ³•
const calculateConversionRates = (userPaths) => {
  // ç»Ÿè®¡æ¯ä¸ªæ­¥éª¤çš„å‚ä¸äººæ•°
  const stepStats = new Map();
  
  userPaths.forEach(userPath => {
    userPath.behaviorPath.forEach(step => {
      const stepKey = step.stepName;
      if (!stepStats.has(stepKey)) {
        stepStats.set(stepKey, {
          stepName: stepKey,
          participantCount: 0,
          totalDuration: 0,
          durations: []
        });
      }
      
      const stats = stepStats.get(stepKey);
      stats.participantCount++;
      if (step.duration) {
        stats.totalDuration += step.duration;
        stats.durations.push(step.duration);
      }
    });
  });
  
  // è®¡ç®—è½¬åŒ–ç‡
  const steps = Array.from(stepStats.values());
  const baseCount = steps[0]?.participantCount || 1; // èµ·å§‹æ­¥éª¤äººæ•°
  
  return steps.map(step => ({
    ...step,
    conversionRate: Math.round((step.participantCount / baseCount) * 100 * 100) / 100, // ä¿ç•™ä¸¤ä½å°æ•°
    averageDuration: step.participantCount > 0 ? Math.round(step.totalDuration / step.participantCount) : 0
  }));
};
```

### 9.5 æ•°æ®è´¨é‡å¤„ç†
**éš¾ç‚¹**ï¼šå¤„ç†çœŸå®æ•°æ®ä¸­çš„å„ç§å¼‚å¸¸æƒ…å†µ
**å…·ä½“æŒ‘æˆ˜**ï¼š
- æ—¶é—´æˆ³å¼‚å¸¸ï¼ˆæœªæ¥æ—¶é—´ã€è¿‡å»æ—¶é—´è¿‡è¿œï¼‰
- ç”¨æˆ·æ ‡è¯†å¼‚å¸¸ï¼ˆç©ºå€¼ã€æ ¼å¼é”™è¯¯ï¼‰
- é¡µé¢è¡Œä¸ºå¼‚å¸¸ï¼ˆéæ ‡å‡†çš„æ‰“å¼€/å…³é—­å€¼ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// æ•°æ®è´¨é‡æ£€æŸ¥å’Œæ¸…æ´—
const validateAndCleanData = (data) => {
  const now = new Date();
  const oneYearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate());
  const oneDayFromNow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
  
  return data.filter(record => {
    // æ£€æŸ¥ç”¨æˆ·æ ‡è¯†
    if (!record.weCustomerKey || record.weCustomerKey.trim() === '') {
      console.warn('å‘ç°ç©ºçš„ç”¨æˆ·æ ‡è¯†:', record);
      return false;
    }
    
    // æ£€æŸ¥æ—¶é—´æˆ³
    const recordTime = new Date(record.createdAt);
    if (isNaN(recordTime.getTime()) || recordTime < oneYearAgo || recordTime > oneDayFromNow) {
      console.warn('å‘ç°å¼‚å¸¸æ—¶é—´æˆ³:', record);
      return false;
    }
    
    // æ£€æŸ¥é¡µé¢è¡Œä¸º
    if (record.pageBehavior && !['æ‰“å¼€', 'å…³é—­'].includes(record.pageBehavior)) {
      console.warn('å‘ç°å¼‚å¸¸é¡µé¢è¡Œä¸º:', record);
      return false;
    }
    
    return true;
  });
};
```

## 10. æµ‹è¯•ç­–ç•¥

### 10.1 å•å…ƒæµ‹è¯•
- æ•°æ®å¤„ç†å™¨åŠŸèƒ½æµ‹è¯•
- è½¬åŒ–ç‡è®¡ç®—å‡†ç¡®æ€§æµ‹è¯•
- æ—¶é—´ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•

### 10.2 é›†æˆæµ‹è¯•
- AIåˆ†æåŠŸèƒ½æµ‹è¯•
- å›¾è¡¨ç”ŸæˆåŠŸèƒ½æµ‹è¯•
- ç”¨æˆ·ç•Œé¢äº¤äº’æµ‹è¯•

### 10.3 æ€§èƒ½æµ‹è¯•
- å¤§æ•°æ®é‡å¤„ç†æ€§èƒ½æµ‹è¯•
- å›¾è¡¨æ¸²æŸ“æ€§èƒ½æµ‹è¯•
- ç”¨æˆ·äº¤äº’å“åº”æ€§èƒ½æµ‹è¯•

## 11. æ‰©å±•æ€§è€ƒè™‘

### 11.1 å¤šç»´åº¦åˆ†æ
- æ”¯æŒæŒ‰ç”¨æˆ·ç¾¤ä½“åˆ†æ
- æ”¯æŒæŒ‰æ—¶é—´æ®µåˆ†æ
- æ”¯æŒæŒ‰è®¾å¤‡ç±»å‹åˆ†æ

### 11.2 é«˜çº§åŠŸèƒ½
- æ”¯æŒA/Bæµ‹è¯•å¯¹æ¯”
- æ”¯æŒé¢„æµ‹åˆ†æ
- æ”¯æŒå¼‚å¸¸æ£€æµ‹

### 11.3 æ•°æ®å¯¼å‡º
- æ”¯æŒå¤šç§æ ¼å¼å¯¼å‡º
- æ”¯æŒè‡ªå®šä¹‰æŠ¥è¡¨
- æ”¯æŒå®šæ—¶æŠ¥å‘Š

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-17  
**ä½œè€…**ï¼šAI Assistant  
**çŠ¶æ€**ï¼šè®¾è®¡é˜¶æ®µ
